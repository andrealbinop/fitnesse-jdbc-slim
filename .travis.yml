language: java

env:
  secure: "dYMdByg1MudMtY9kfHdicsxAvq7XZ2kXbYOLqYXO4qyLSed35S1lLlKtcE7F8m5TrUNvFau9KPVfC3POxZ1O41TkIQ+4p87UsHhvpE8t+XiRYCS1l1aMLdb0IaeJJnUgz+VHAZctk3HkvupxdE6lvoIHPXGdWRCh8aCWb1TPn4k="

after_success:
  - mvn clean test jacoco:report org.eluder.coveralls:coveralls-maven-plugin:report

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: OIJ/1TSmr7eZ+6Nwpf3v1ly43rhQbpoEVITHvjs3H/RhcE7vfZEmJwmgGsx/QtSobrCQfU22VGIzppiV/s3TrtyEsfNlS9kroGizIHG5iv0Brb77/GiRoStudIMxtNsiRstivLxlePVOs2wRcXm2NvCqEkSLf11uhH5ciBfKsB0=
  file_glob: true
  file: target/*.jar
  on:
    tags: true
    all_branches: true

after_deploy:
    - openssl aes-256-cbc -K $encrypted_db61717a69e2_key -iv $encrypted_db61717a69e2_iv -in ossrh_keys.tar.gz.enc -out ossrh_keys.tar.gz -d
    - tar -zxvf ossrh_keys.tar.gz
    - gpg --import private.key && gpg --import public.key
    - echo "<settings><servers><server><id>ossrh</id><username>\${env.ossrh_username}</username><password>\${env.ossrh_password}</password></server><server><id>gpg.passphrase</id><passphrase>\${env.ossrh_password}</passphrase></server></servers></settings>" > ~/settings.xml
    - mvn deploy -DskipTests=true -s ~/settings.xml -PactivateDeploy
